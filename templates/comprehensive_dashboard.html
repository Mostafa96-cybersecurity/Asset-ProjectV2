<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Asset Management Dashboard - 520+ Columns</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #17a2b8;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px;
            padding: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card:hover::before {
            transform: translateX(100%);
        }
        
        .stat-card.success {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
        }
        
        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }
        
        .stat-card.danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        
        .stat-card.info {
            background: linear-gradient(135deg, var(--info-color), #138496);
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-icon {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 3rem;
            opacity: 0.3;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .asset-table {
            width: 100% !important;
        }
        
        .asset-table th {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .asset-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-online { background: var(--success-color); color: white; }
        .status-offline { background: var(--danger-color); color: white; }
        .status-unknown { background: var(--warning-color); color: white; }
        
        .classification-complete { background: var(--success-color); color: white; }
        .classification-pending { background: var(--warning-color); color: white; }
        .classification-incomplete { background: var(--danger-color); color: white; }
        
        .search-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-custom {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 50px;
        }
        
        .progress-bar-custom {
            height: 8px;
            border-radius: 10px;
            background: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--success-color));
        }
        
        .asset-detail-modal .modal-content {
            border-radius: 20px;
            overflow: hidden;
        }
        
        .asset-detail-modal .modal-header {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 20px 30px;
        }
        
        .asset-detail-modal .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .field-category {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid var(--secondary-color);
        }
        
        .field-category h5 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .field-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .field-row:last-child {
            border-bottom: none;
        }
        
        .field-name {
            font-weight: 600;
            color: var(--primary-color);
            flex: 1;
        }
        
        .field-value {
            flex: 2;
            text-align: right;
            color: #666;
        }
        
        .real-time-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .real-time-indicator.updating {
            background: var(--warning-color);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .column-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .column-stats h4 {
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .column-stats .big-number {
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Real-time indicator -->
    <div id="realTimeIndicator" class="real-time-indicator">
        <i class="fas fa-wifi"></i> Live Data
    </div>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="display-4 text-primary mb-2">
                    <i class="fas fa-database"></i> Comprehensive Asset Management
                </h1>
                <p class="lead text-muted">Advanced Dashboard with 520+ Data Columns</p>
                <div class="column-stats">
                    <h4>Database Schema</h4>
                    <div class="big-number" id="totalColumns">520</div>
                    <p>Total Available Columns</p>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-number" id="totalAssets">-</div>
                    <div class="stat-label">Total Assets</div>
                    <div class="stat-icon"><i class="fas fa-server"></i></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card success">
                    <div class="stat-number" id="onlineAssets">-</div>
                    <div class="stat-label">Online Assets</div>
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card warning">
                    <div class="stat-number" id="incompleteAssets">-</div>
                    <div class="stat-label">Incomplete Assets</div>
                    <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card info">
                    <div class="stat-number" id="dataCompleteness">-</div>
                    <div class="stat-label">Avg Completeness</div>
                    <div class="stat-icon"><i class="fas fa-chart-pie"></i></div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="row">
                <div class="col-md-8">
                    <h5><i class="fas fa-cogs"></i> Asset Control Panel</h5>
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary btn-custom" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                        <button class="btn btn-success btn-custom" onclick="collectAllData()">
                            <i class="fas fa-download"></i> Collect All Data
                        </button>
                        <button class="btn btn-info btn-custom" onclick="exportData()">
                            <i class="fas fa-file-export"></i> Export Assets
                        </button>
                        <button class="btn btn-warning btn-custom" onclick="showColumnAnalysis()">
                            <i class="fas fa-columns"></i> Column Analysis
                        </button>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                        <label class="form-check-label" for="autoRefresh">Auto Refresh (30s)</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="search-container">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search assets...">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="deviceTypeFilter">
                        <option value="">All Device Types</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="manufacturerFilter">
                        <option value="">All Manufacturers</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="statusFilter">
                        <option value="">All Statuses</option>
                        <option value="Online">Online</option>
                        <option value="Offline">Offline</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100" onclick="applyFilters()">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-doughnut"></i> Device Type Distribution</h5>
                    <canvas id="deviceTypeChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5><i class="fas fa-chart-bar"></i> Data Completeness by Asset</h5>
                    <canvas id="completenessChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Assets Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-table"></i> Asset Inventory</h5>
                <span class="badge bg-primary fs-6" id="assetCount">Loading...</span>
            </div>
            
            <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading comprehensive asset data...</p>
            </div>
            
            <div class="table-responsive">
                <table id="assetsTable" class="table asset-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Hostname</th>
                            <th>IP Address</th>
                            <th>Device Type</th>
                            <th>Status</th>
                            <th>Classification</th>
                            <th>Manufacturer</th>
                            <th>Model</th>
                            <th>OS</th>
                            <th>Memory (GB)</th>
                            <th>Storage (GB)</th>
                            <th>Completeness</th>
                            <th>Last Seen</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="assetsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Asset Detail Modal -->
    <div class="modal fade asset-detail-modal" id="assetDetailModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-server"></i> Complete Asset Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="assetDetailBody">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading comprehensive asset details...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global variables
        let assetsDataTable;
        let autoRefreshInterval;
        let charts = {};

        // Initialize dashboard
        $(document).ready(function() {
            console.log('🚀 Initializing Comprehensive Asset Dashboard...');
            loadDashboardData();
            setupAutoRefresh();
            setupEventHandlers();
        });

        // Load all dashboard data
        function loadDashboardData() {
            updateRealTimeIndicator(true);
            loadStatistics();
            loadAssets();
        }

        // Load statistics
        function loadStatistics() {
            $.get('/api/stats')
                .done(function(data) {
                    console.log('📊 Statistics loaded:', data);
                    updateStatistics(data);
                    updateCharts(data);
                })
                .fail(function() {
                    console.error('❌ Failed to load statistics');
                    showError('Failed to load statistics');
                })
                .always(function() {
                    updateRealTimeIndicator(false);
                });
        }

        // Update statistics cards
        function updateStatistics(data) {
            $('#totalAssets').text(data.total_assets || 0);
            $('#onlineAssets').text(data.device_status?.Online || 0);
            $('#incompleteAssets').text(data.incomplete_assets || 0);
            $('#dataCompleteness').text((data.avg_data_completeness || 0) + '%');
            
            // Update filters
            updateFilters(data);
        }

        // Update filter dropdowns
        function updateFilters(data) {
            // Device types
            const deviceTypeSelect = $('#deviceTypeFilter');
            deviceTypeSelect.empty().append('<option value="">All Device Types</option>');
            data.device_types?.forEach(type => {
                deviceTypeSelect.append(`<option value="${type.name}">${type.name} (${type.count})</option>`);
            });

            // Manufacturers
            const manufacturerSelect = $('#manufacturerFilter');
            manufacturerSelect.empty().append('<option value="">All Manufacturers</option>');
            data.manufacturers?.forEach(mfg => {
                manufacturerSelect.append(`<option value="${mfg.name}">${mfg.name} (${mfg.count})</option>`);
            });
        }

        // Update charts
        function updateCharts(data) {
            updateDeviceTypeChart(data.device_types || []);
            updateCompletenessChart(data);
        }

        // Device type chart
        function updateDeviceTypeChart(deviceTypes) {
            const ctx = document.getElementById('deviceTypeChart');
            if (charts.deviceType) {
                charts.deviceType.destroy();
            }

            charts.deviceType = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: deviceTypes.map(d => d.name),
                    datasets: [{
                        data: deviceTypes.map(d => d.count),
                        backgroundColor: [
                            '#3498db', '#e74c3c', '#2ecc71', '#f39c12', 
                            '#9b59b6', '#1abc9c', '#34495e', '#e67e22'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Completeness chart
        function updateCompletenessChart(data) {
            const ctx = document.getElementById('completenessChart');
            if (charts.completeness) {
                charts.completeness.destroy();
            }

            const classification = data.asset_classification || {};
            charts.completeness = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(classification),
                    datasets: [{
                        label: 'Assets',
                        data: Object.values(classification),
                        backgroundColor: ['#e74c3c', '#f39c12', '#2ecc71']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Load assets table
        function loadAssets() {
            const searchParams = new URLSearchParams();
            
            // Add filters
            const search = $('#searchInput').val();
            if (search) searchParams.set('search', search);
            
            const deviceType = $('#deviceTypeFilter').val();
            if (deviceType) searchParams.set('device_type', deviceType);
            
            const manufacturer = $('#manufacturerFilter').val();
            if (manufacturer) searchParams.set('manufacturer', manufacturer);
            
            const status = $('#statusFilter').val();
            if (status) searchParams.set('status', status);

            $('#loadingSpinner').show();
            $('#assetsTable').hide();

            $.get(`/api/assets?${searchParams.toString()}`)
                .done(function(data) {
                    console.log('📋 Assets loaded:', data.assets?.length || 0);
                    updateAssetsTable(data);
                })
                .fail(function() {
                    console.error('❌ Failed to load assets');
                    showError('Failed to load assets');
                })
                .always(function() {
                    $('#loadingSpinner').hide();
                    $('#assetsTable').show();
                });
        }

        // Update assets table
        function updateAssetsTable(data) {
            const tbody = $('#assetsTableBody');
            tbody.empty();

            $('#assetCount').text(`${data.total || 0} Assets`);

            if (assetsDataTable) {
                assetsDataTable.destroy();
            }

            data.assets?.forEach(asset => {
                const row = createAssetRow(asset);
                tbody.append(row);
            });

            // Initialize DataTable
            assetsDataTable = $('#assetsTable').DataTable({
                pageLength: 25,
                order: [[11, 'desc']], // Sort by last seen
                columnDefs: [
                    { orderable: false, targets: -1 } // Actions column
                ]
            });
        }

        // Create asset table row
        function createAssetRow(asset) {
            const statusClass = getStatusClass(asset.device_status);
            const classificationClass = getClassificationClass(asset.classification);
            const completeness = asset.data_completeness_score || 0;
            
            return `
                <tr>
                    <td><strong>${asset.hostname || 'Unknown'}</strong></td>
                    <td>${asset.ip_address || 'N/A'}</td>
                    <td>${asset.device_type || 'Unknown'}</td>
                    <td><span class="status-badge ${statusClass}">${asset.device_status || 'Unknown'}</span></td>
                    <td><span class="status-badge ${classificationClass}">${asset.classification || 'Unknown'}</span></td>
                    <td>${asset.system_manufacturer || 'Unknown'}</td>
                    <td>${asset.system_model || 'Unknown'}</td>
                    <td>${asset.operating_system || 'Unknown'}</td>
                    <td>${asset.total_physical_memory_gb ? Math.round(asset.total_physical_memory_gb) : 'N/A'}</td>
                    <td>${asset.total_storage_gb ? Math.round(asset.total_storage_gb) : 'N/A'}</td>
                    <td>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar progress-bar-custom" style="width: ${completeness}%"></div>
                        </div>
                        <small>${completeness.toFixed(1)}%</small>
                    </td>
                    <td>${formatDate(asset.last_seen)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewAssetDetails(${asset.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-success" onclick="collectAssetData('${asset.hostname}')">
                            <i class="fas fa-sync"></i>
                        </button>
                    </td>
                </tr>
            `;
        }

        // Get status CSS class
        function getStatusClass(status) {
            switch(status?.toLowerCase()) {
                case 'online': return 'status-online';
                case 'offline': return 'status-offline';
                default: return 'status-unknown';
            }
        }

        // Get classification CSS class
        function getClassificationClass(classification) {
            switch(classification?.toLowerCase()) {
                case 'complete asset': return 'classification-complete';
                case 'classification pending': return 'classification-pending';
                case 'asset incomplete': return 'classification-incomplete';
                default: return 'status-unknown';
            }
        }

        // View asset details
        function viewAssetDetails(assetId) {
            $('#assetDetailModal').modal('show');
            
            $.get(`/api/assets/${assetId}`)
                .done(function(data) {
                    displayAssetDetails(data);
                })
                .fail(function() {
                    $('#assetDetailBody').html('<div class="alert alert-danger">Failed to load asset details</div>');
                });
        }

        // Display comprehensive asset details
        function displayAssetDetails(data) {
            if (data.status !== 'success') {
                $('#assetDetailBody').html('<div class="alert alert-danger">Asset not found</div>');
                return;
            }

            const asset = data.asset;
            const categories = data.categories;
            
            let html = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6><i class="fas fa-info-circle"></i> Asset Summary</h6>
                        <p><strong>Total Fields:</strong> ${data.total_fields}</p>
                        <p><strong>Filled Fields:</strong> ${data.filled_fields}</p>
                        <p><strong>Completeness:</strong> ${((data.filled_fields / data.total_fields) * 100).toFixed(1)}%</p>
                    </div>
                    <div class="col-md-6">
                        <div class="progress mb-2">
                            <div class="progress-bar progress-bar-custom" style="width: ${(data.filled_fields / data.total_fields) * 100}%"></div>
                        </div>
                    </div>
                </div>
            `;

            // Display categorized data
            Object.entries(categories).forEach(([categoryName, fields]) => {
                if (Object.keys(fields).length > 0) {
                    html += `
                        <div class="field-category">
                            <h5><i class="fas fa-folder"></i> ${categoryName.replace(/_/g, ' ').toUpperCase()}</h5>
                    `;
                    
                    Object.entries(fields).forEach(([key, value]) => {
                        if (value !== null && value !== '') {
                            const displayValue = typeof value === 'string' && value.length > 100 
                                ? value.substring(0, 100) + '...' 
                                : value;
                            
                            html += `
                                <div class="field-row">
                                    <div class="field-name">${key.replace(/_/g, ' ')}</div>
                                    <div class="field-value">${displayValue}</div>
                                </div>
                            `;
                        }
                    });
                    
                    html += '</div>';
                }
            });

            $('#assetDetailBody').html(html);
        }

        // Collect asset data
        function collectAssetData(hostname) {
            updateRealTimeIndicator(true);
            
            $.get(`/api/collect/${hostname}`)
                .done(function(data) {
                    if (data.status === 'success') {
                        showSuccess(`Data collection completed for ${hostname}`);
                        loadDashboardData(); // Refresh all data
                    } else {
                        showError(`Collection failed: ${data.error}`);
                    }
                })
                .fail(function() {
                    showError('Failed to trigger data collection');
                })
                .always(function() {
                    updateRealTimeIndicator(false);
                });
        }

        // Control panel functions
        function refreshData() {
            loadDashboardData();
        }

        function collectAllData() {
            updateRealTimeIndicator(true);
            $.get('/api/collect-all')
                .done(function(data) {
                    showSuccess('Comprehensive data collection started');
                    setTimeout(loadDashboardData, 5000); // Refresh after 5 seconds
                })
                .fail(function() {
                    showError('Failed to start data collection');
                })
                .always(function() {
                    updateRealTimeIndicator(false);
                });
        }

        function exportData() {
            window.open('/api/assets?export=csv', '_blank');
        }

        function showColumnAnalysis() {
            alert('Column Analysis: Currently supporting 520 comprehensive columns including:\n\n' +
                  '• System Identification (20 columns)\n' +
                  '• Hardware Details (100+ columns)\n' +
                  '• Software Inventory (50+ columns)\n' +
                  '• Network Configuration (40+ columns)\n' +
                  '• Security Settings (30+ columns)\n' +
                  '• Performance Metrics (30+ columns)\n' +
                  '• Management Data (30+ columns)\n' +
                  '• Collection Metadata (20+ columns)\n\n' +
                  'Data collected via WMI, SSH, SNMP, and Registry');
        }

        function applyFilters() {
            loadAssets();
        }

        // Auto refresh setup
        function setupAutoRefresh() {
            $('#autoRefresh').change(function() {
                if (this.checked) {
                    autoRefreshInterval = setInterval(loadDashboardData, 30000);
                } else {
                    clearInterval(autoRefreshInterval);
                }
            });
            
            // Start auto refresh
            autoRefreshInterval = setInterval(loadDashboardData, 30000);
        }

        // Event handlers
        function setupEventHandlers() {
            $('#searchInput').on('keypress', function(e) {
                if (e.which === 13) {
                    applyFilters();
                }
            });
        }

        // Real-time indicator
        function updateRealTimeIndicator(updating) {
            const indicator = $('#realTimeIndicator');
            if (updating) {
                indicator.addClass('updating').html('<i class="fas fa-sync fa-spin"></i> Updating...');
            } else {
                indicator.removeClass('updating').html('<i class="fas fa-wifi"></i> Live Data');
            }
        }

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return 'Never';
            return new Date(dateString).toLocaleString();
        }

        function showSuccess(message) {
            // Simple alert for now, could be replaced with toast notification
            const alert = $(`<div class="alert alert-success alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`);
            $('.dashboard-container').prepend(alert);
            setTimeout(() => alert.alert('close'), 5000);
        }

        function showError(message) {
            const alert = $(`<div class="alert alert-danger alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`);
            $('.dashboard-container').prepend(alert);
            setTimeout(() => alert.alert('close'), 5000);
        }

        // Add search functionality
        $('#searchInput').on('input', function() {
            if (assetsDataTable) {
                assetsDataTable.search(this.value).draw();
            }
        });

        console.log('🎉 Comprehensive Asset Dashboard Initialized');
    </script>
</body>
</html>